<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

    <title>welcome</title>
		<script src="../resource/mobile/mui.min.js"></script>
		<script src="../resource/mobile/app.js"></script>
		<script src="../resource/mobile/zepto.min.js"></script>
				<script src="../resource/mobile/common.js"></script>
		
		<script src="../resource/mobile/matrixmobile.js"></script>
		
		<link rel="stylesheet" href="../resource/mobile/public.css">
		<link rel="stylesheet" href="../resource/mobile/mui.min.css">
		<link rel="stylesheet" href="../resource/mobile/matrix-base.css" />
		<style>
			.mrow{}
		</style>
	</head>

	<body class="mui-fullscreen" >
	        
         <!-- 侧滑导航根容器 -->
    <div class="mui-off-canvas-wrap mui-draggable" id="offCanvasWrapper">
        <!-- 菜单容器 -->
        <aside class="mui-off-canvas-left">
            <div class="mui-scroll-wrapper">
                <div class="mui-scroll">
                    <!-- 菜单具体展示内容 -->
                    <div class="user-info">
	<a href="javascript:;">
			<img class="mui-media-object mui-pull-left" src="/Public/assets/images/logo.png">
			<div class="mui-media-body">
				天行者
				<p class='mui-ellipsis'>注册之后内容更精彩!</p>
			</div>
		</a>
		<!--<p class='mui-ellipsis'>想要这样一间小木屋，夏天挫冰吃瓜，冬天围炉取暖.</p>-->
		<p style="text-align: center;">
			<a href="http://m.skywalk-er.com/member/public/login" class="mui-btn mui-btn-outlined mui-btn-primary">登陆 </a>
			<a href="http://m.skywalk-er.com/member/public/register" class="mui-btn mui-btn-outlined mui-btn-primary">注册 </a>
		</p>
	</div>
<ul class="mui-table-view2 mui-table-view-chevron mui-table-view-inverted">
	<li class="mui-table-view-cell">
		<a href="http://m.skywalk-er.com/" class="mui-navigate-right mui-ellipsis"><span class="mui-icon mui-icon-home"></span> 首页 <span class="left-desc">Home</span></a>
	</li>
	<li class="mui-table-view-cell">
		<a href="http://m.skywalk-er.com/products/index/cid/1.html" class="mui-navigate-right mui-ellipsis"><span class="mui-icon iconfont icon-xianluxuanxiangqiatejia"></span> 特价啦 <span class="left-desc">Spacial offer</span></a>
	</li>
	<li class="mui-table-view-cell">
		<a href="http://m.skywalk-er.com/products/index/cid/4.html" class="mui-navigate-right mui-ellipsis"><span class="mui-icon iconfont icon-xianluxuanxiangqiaziyouxing"></span> 省内游<span class="left-desc">The province</span></a>
	</li>
	<li class="mui-table-view-cell">
		<a href="http://m.skywalk-er.com/products/index/cid/3.html" class="mui-navigate-right mui-ellipsis"><span class="mui-icon iconfont icon-xianluxuanxiangqiaguonei"></span> 国内游<span class="left-desc">Domestic</span></a>
	</li>
	<li class="mui-table-view-cell">
		<a href="http://m.skywalk-er.com/products/index/cid/2.html" class="mui-navigate-right mui-ellipsis"><span class="mui-icon iconfont icon-xianluxuanxiangqiaguoji"></span> 国际游<span class="left-desc">International</span></a>
	</li>
	<li class="mui-table-view-cell">
		<a href="http://m.skywalk-er.com/air.html" class="mui-navigate-right mui-ellipsis"><span class="mui-icon iconfont icon-jipiao"></span> 机票<span class="left-desc">Flight ticket</span></a>
	</li>
	<li class="mui-table-view-cell">
		<a href="http://m.skywalk-er.com/hotel.html" class="mui-navigate-right mui-ellipsis"><span class="mui-icon iconfont icon-jiudian"></span> 酒店<span class="left-desc">Hotel</span></a>
	</li>
	<li class="mui-table-view-cell">
		<a href="http://m.skywalk-er.com/sign.html" class="mui-navigate-right mui-ellipsis"><span class="mui-icon iconfont icon-xitongtixing"></span> 签证<span class="left-desc">Passport</span></a>
	</li>
	<li class="mui-table-view-cell">
		<a href="http://m.skywalk-er.com/community.html" class="mui-navigate-right mui-ellipsis"><span class="mui-icon iconfont icon-gongnengyeshequhaoyouhudong"></span> 社区<span class="left-desc">Community</span></a>
	</li>

</ul>
                </div>
            </div>
        </aside>
        
        
		<div class="mui-inner-wrap">
		<div class="mui-content">
		 <header class="mui-bar mui-bar-nav">
                <a id="offCanvasShow" href="#offCanvasSide" class="mui-icon mui-action-menu mui-icon-bars mui-pull-left"></a>
                <a id="searchAction" href="#offCanvasSide" class="mui-icon mui-action-search mui-icon-search mui-pull-right"></a>
                <h1 class="mui-title">公文管理</h1>
                
            </header>
			<div id="searchContent" class="mui-input-row mui-search" style="top: 42px;z-index:999;display:none;">
			    <input  id="startNum" type="hidden" value="0">
			    <input  id="totalPageNum" type="hidden" value="0">
				<input  id="queryKeyword" type="search" class="mui-input-clear mui-pull-left" placeholder="查询">
			</div>
			<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="top:42px;">
		<a id="readyTask" class="mui-control-item mui-active" href="#item3mobile">
				待办任务
			</a>
		<a id="completedTask" class="mui-control-item" href="#item3mobile">
				已办任务
			</a>
		<a class="mui-control-item" href="#item3mobile">
				已发事项
			</a>
	</div>
	
			<div id="datalist" class="mui-content mui-scroll-wrapper" style="top: 85px;" onchange="">
				<div class="mui-scroll">
					<ul id="datatable" class="mui-table-view mui-table-view-chevron"></ul>
				</div>
			</div>
            <div class="mui-backdrop" style="display:none;"></div>
			
			<footer class="mui-bar .mui-bar-footer" style="bottom:0px;text-align:center;">
  <ul class="mui-pager">
		<li>
			<a id="page-pre" href="#">
					上一页
				</a>
		</li>
		<li id="page-info">
					第1页/共 页
		</li>
		<li>
			<a id="page-next" href="#">
					下一页
				</a>
		</li>
		
	</ul>
  <span  class="mui-action mui-action-previous mui-icon mui-icon-back"></span>
  <span class="mui-number">1/2</span>
		<span class="mui-action mui-action-next mui-icon mui-icon-forward"></span>
            </footer>


		</div>
		</div>
		
		</div>
		<script>
		   var type = "";
		   function initParam(){
	   	      type = matrix.getParam("type");
		   }
		   window.onload = initParam();
		   
			var dataType = null;//列表数据类型
			var pullType = null;
			var first = true;
			
			//监听前一页点击
			document.getElementById('searchAction').addEventListener('tap',function(){
			    var value = document.getElementById('searchContent').style.display;
			    if(value == "none"){
					document.getElementById('searchContent').style.display="block";
					
					//document.getElementById('sliderSegmentedControl').style.top="82px";
					//document.getElementById('datalist').style.top="122px";
				}else{	
					document.getElementById('searchContent').style.display="none";
					//document.getElementById('sliderSegmentedControl').style.top="42px";
					//document.getElementById('datalist').style.top="82px";
				}	
			});	
			
			//监听前一页点击
			document.getElementById('page-pre').addEventListener('tap',function(){
			   var startNumValue = document.getElementById("startNum").value;
			   if(startNumValue == 0)
			   		return;
	           clearData();
				pulldownRefresh();
			   startNumValue = startNumValue - 1;
			   document.getElementById("startNum").value = startNumValue;
			});
		
		    //监听后一页点击
			document.getElementById('page-next').addEventListener('tap',function(){
			   var startNumValue = document.getElementById("startNum").value;
			   var totalPageNumValue = document.getElementById("totalPageNum").value;
			   
			   //如果当前已经是最后一行,什么也不做
			   if(totalPageNumValue != 0 && (totalPageNumValue == (startNumValue / matrix.DEFAULT_PAGE_SIZE)))
			   		return;

	           clearData();
				pullupRefresh();
			   startNumValue = startNumValue + 1;
			   document.getElementById("startNum").value = startNumValue;
			   
			});
			
			 //监听标签切换
			document.getElementById('readyTask').addEventListener('tap',function(){
			   type = "readyTask";
			   var startNumValue = 0; 
			   document.getElementById("startNum").value = startNumValue;
			   
	           clearData();
				pullupRefresh();
			});
		
			document.getElementById('completedTask').addEventListener('tap',function(){
			   type = "completedTask";
			   var startNumValue = 0; 
			   document.getElementById("startNum").value = startNumValue;
			   
	           clearData();
				pullupRefresh();
			});

			//初始数据
			function initData(){
				  first = true;
				  clearData();
				  //加载
				  mui('#datalist').pullRefresh().endPullupToRefresh(false);
				  mui('#datalist').pullRefresh().pullupLoading();
				  mui('#datalist').pullRefresh().endPullupToRefresh(true);
			}
			
			//清空原有数据
			function clearData(){
				  var table = document.body.querySelector('.mui-table-view');
				  while(table.hasChildNodes()){
				      table.removeChild(table.lastChild);
				  }
			}
			
			//加载数据
			function loadData(){
				matrix.log("load page data .....");
				var table = document.body.querySelector('.mui-table-view');
				var cells = document.body.querySelectorAll('.mui-table-view-cell');
				//var startNum = 0;
				//if(cells!=null && cells.length>0){
					//startNum = cells.length-1;
				//}
				var startNum = document.getElementById("startNum").value;
				
				dataType = type;
				if(dataType=="readyTask" || dataType=="completedTask"){
					//待办、已办、退回任务
					
					var data = {};
					data["queryStartNum"] = startNum * matrix.DEFAULT_PAGE_SIZE;
					data["queryPageSize"] = matrix.DEFAULT_PAGE_SIZE;
					data["queryType"] = dataType;
					if(document.getElementById("queryKeyword").value!=null){
						data["queryKeyword"] = document.getElementById("queryKeyword").value;
					}
					matrix.sendRequest("mobile/task_queryTask.action",data,loadDataCallback);
				}else{
					setTimeout(function() {
						mui('#datalist').pullRefresh().endPullupToRefresh((true));
					}, 1000);
				}
			}
			
			//加载数据回调方法
			function loadDataCallback(response){
				
				matrix.log("load page data call back .....");
				if(response!=null && response.data!=null){
					var table = document.body.querySelector('.mui-table-view');
					var data = response.data;
					if(pullType==null || pullType=="up"){
						setTimeout(function() {
							for (var i = 0, len = data.length; i < len; i++) {
									var record = data[i];
									//上拉刷新，新纪录插到最后面；
									table.appendChild(getRecordHTML(record));
							}
							//设置当前页和总页数
							//var pageInfo = "";
							var curPageNum = response.curPageNum;
							var totalPageNum = response.totalPageNum;
							//pageInfo = "第"+curPageNum+"页/共"++"页";
							document.getElementById("page-info").innerText = "第"+curPageNum+"页/共"+totalPageNum+"页";
							
							if(first){
								var cells = document.body.querySelectorAll('.mrow');
								
								if(cells.length<matrix.DEFAULT_PAGE_SIZE){
									matrix.log(1111);
									mui('#datalist').pullRefresh().endPullupToRefresh(true); 
								}
								first = false;
							}else{
								mui('#datalist').pullRefresh().endPullupToRefresh((data.length==0));
							}
						}, 1000);
					}else if(pullType=="down"){
						//下拉刷新，新纪录插到最前面；
							setTimeout(function() {
								for (var i = 0, len = data.length; i < len; i++) {
									var row = data[i];
									var li = document.createElement('li');
									li.className = 'mui-table-view-cell';
									li.innerHTML = '<a class="mui-navigate-right">' +row.title+'</a>';
									//下拉刷新，新纪录插到最前面；
									table.insertBefore(li, table.firstChild);
								}
								mui('#datalist').pullRefresh().endPulldownToRefresh(); //refresh completed\n
								
							}, 1000);
					}
				}
			}
			
			/**
			 * 下拉刷新具体业务实现
			 */
			function pulldownRefresh() {
					pullType = "down";
					loadData();
			}
			
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				matrix.log("pull up refresh .....");
				pullType = "up";
				loadData();
			}
			
			mui.init({
			
			
				swipeBack: false,
				pullRefresh: {
					container: '#datalist',
//					down: {
//						callback: pulldownRefresh
//					},
					up: {
                contentrefresh: "正在加载...", //可选，正在加载状态时，上拉加载控件上显示的标题内容
						callback: pullupRefresh
					}
				}
			});
			
			//添加检索键监听
			document.getElementById("queryKeyword").addEventListener('keyup', function(e) {
				//console.log(e.which || e.keyCode);
				var keyCode = (e.which || e.keyCode);
				if(keyCode==13){
				  //检索键key值
				   document.getElementById("startNum").value = 0;
				  initData();
				}
			});
			
			if (mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
						mui('#datalist').pullRefresh().pullupLoading();
					}, 1000);
				});
			} else {
				mui.ready(function() {
					mui('#datalist').pullRefresh().pullupLoading();
				});
				
			}
			
			function getRecordHTML(record){
				var recordStr = "";
				if(dataType=="readyTask"){
					//待办任务
					var exeUrl = "";//执行url
					exeUrl+="mobile/exetask.html?taskURL=";
					exeUrl+=record.exeURL;
					exeUrl+="&piid=";
					exeUrl+=record.piid;
					exeUrl+="&aiid=";
					exeUrl+=record.aiid;
					exeUrl+="&taskId=";
					exeUrl+=record.taskId;
					exeUrl+="&mBizId=";
					exeUrl+=record.exAttributeA;
					exeUrl+="&pdid=";
					exeUrl+=record.pdid;
					exeUrl+="&adid=";
					exeUrl+=record.adid;
					exeUrl+="&isMobile=true";
					exeUrl = matrix.convertRequestUrl(exeUrl);
					
					//监控url
					var monitorUrl = "mobile/process-monitor.html?piid=";
					monitorUrl+=record.piid;
					monitorUrl = matrix.convertRequestUrl(monitorUrl);
					
					
					var row = document.createElement('li');
					row.className = 'mui-table-view-cell mui-collapse mrow';
					
					var row_title = document.createElement('a');
					row_title.className = "mui-navigate-right";
					row_title.href = "#";
					//row_title.innerHTML = record.desc;
					row.appendChild(row_title);
					
					//图片
					var img = document.createElement('img');
					img.className = "mui-media-object mui-pull-left";
					img.src = "http://192.168.1.102:9090/moffice/resource/mobile/pic1.jpg";
					row_title.appendChild(img);
					
					var contentDiv = document.createElement('div');
					contentDiv.className = "mui-media-body";
					row_title.appendChild(contentDiv);
					
					var nameSpan = document.createElement('b');
					//nameDiv.className = "mui-media-body";
					nameSpan.innerHTML = record.desc;
					contentDiv.appendChild(nameSpan);

					var userDiv = document.createElement('div');
					userDiv.className = "mui-media-body";
					row_title.appendChild(userDiv);

					var nameSpan = document.createElement('span');
					nameSpan.innerHTML = record.starterName;
					userDiv.appendChild(nameSpan);
					
					var dateSpan = document.createElement('span');
					dateSpan.setAttribute("style","float:right;");
					dateSpan.innerHTML = record.receivedDate;
					userDiv.appendChild(dateSpan);
					
					//菜单
					var menu = document.createElement('ul'); 
					menu.className = "mui-table-view mui-table-view-chevron";
					row.appendChild(menu);
					
					//菜单项-执行
					var menu_item0 = document.createElement('li');
					menu_item0.className = "mui-table-view-cell";
					menu.appendChild(menu_item0);
					
					//菜单项-执行-链接
					var a_menu_item0 = document.createElement('a');
					a_menu_item0.className = "mui-navigate-right";
					a_menu_item0.href = exeUrl;
					a_menu_item0.innerHTML = "执行";
					a_menu_item0.setAttribute("open-type","common-embed");
					a_menu_item0.setAttribute("headerTitle","审批详情");
					menu_item0.appendChild(a_menu_item0);
					
					//菜单项-监控
					var menu_item1 = document.createElement('li');
					menu_item1.className = "mui-table-view-cell";
					menu.appendChild(menu_item1);
					
					//菜单项-监控-链接
					var a_menu_item1 = document.createElement('a');
					a_menu_item1.className = "mui-navigate-right";
					a_menu_item1.href = monitorUrl;
					a_menu_item1.innerHTML = "监控";
					a_menu_item1.setAttribute("open-type","common-embed");
					a_menu_item1.setAttribute("headerTitle","监控审批");
					menu_item1.appendChild(a_menu_item1);
					
					//菜单项-意见
					var menu_item2 = document.createElement('li');
					menu_item2.className = "mui-table-view-cell";
					menu.appendChild(menu_item2);
					
					//菜单项-意见-链接
					var a_menu_item2 = document.createElement('a');
					a_menu_item2.className = "mui-navigate-right";
					a_menu_item2.innerHTML = "意见";
					a_menu_item2.setAttribute("open-type","common-list");
					a_menu_item2.setAttribute("data-type","comment");
					a_menu_item2.setAttribute("headerTitle","审批意见");
					a_menu_item2.setAttribute("piid",record.piid);
					menu_item2.appendChild(a_menu_item2);
					return row;
					
				}else if(dataType=="completedTask"){
					//已办任务
					var exeUrl = "";//查看url
					exeUrl+=record.exeURL+".rform?&matrix_view_flag=true";
					exeUrl+="&mBizId=";
					exeUrl+=record.exAttributeA;
					exeUrl = matrix.convertRequestUrl(exeUrl);
					
					matrix.log(exeUrl);
					
					//监控url
					var monitorUrl = "processMonitorHelper?matrixMonitorKey=ProcessMonitor&piid=";
					monitorUrl+=record.piid;
					monitorUrl = matrix.convertRequestUrl(monitorUrl);
					
					
					var row = document.createElement('li');
					row.className = 'mui-table-view-cell mui-collapse mrow';
					
					var row_title = document.createElement('a');
					row_title.className = "mui-navigate-right";
					row_title.href = "#";
					//row_title.innerHTML = record.desc;
					row.appendChild(row_title);
					
					//图片
					var img = document.createElement('img');
					img.className = "mui-media-object mui-pull-left";
					img.src = "http://192.168.1.102:9090/moffice/resource/mobile/pic1.jpg";
					row_title.appendChild(img);
					
					var contentDiv = document.createElement('div');
					contentDiv.className = "mui-media-body";
					row_title.appendChild(contentDiv);
					
					var nameSpan = document.createElement('b');
					//nameDiv.className = "mui-media-body";
					nameSpan.innerHTML = record.desc;
					contentDiv.appendChild(nameSpan);

					var userDiv = document.createElement('div');
					userDiv.className = "mui-media-body";
					row_title.appendChild(userDiv);

					var nameSpan = document.createElement('span');
					nameSpan.innerHTML = record.activityName;
					userDiv.appendChild(nameSpan);
					
					var dateSpan = document.createElement('span');
					dateSpan.setAttribute("style","float:right;");
					dateSpan.innerHTML = record.lastModifiedDate;
					userDiv.appendChild(dateSpan);
					
					//菜单
					var menu = document.createElement('ul'); 
					menu.className = "mui-table-view mui-table-view-chevron";
					row.appendChild(menu);
					
					//菜单项-查看
					var menu_item0 = document.createElement('li');
					menu_item0.className = "mui-table-view-cell";
					menu.appendChild(menu_item0);
					
					//菜单项-查看-链接
					var a_menu_item0 = document.createElement('a');
					a_menu_item0.className = "mui-navigate-right";
					a_menu_item0.href = exeUrl;
					a_menu_item0.innerHTML = "查看";
					a_menu_item0.setAttribute("open-type","common-embed");
					a_menu_item0.setAttribute("headerTitle","事项详情");
					menu_item0.appendChild(a_menu_item0);
					
					//菜单项-监控
					var menu_item1 = document.createElement('li');
					menu_item1.className = "mui-table-view-cell";
					menu.appendChild(menu_item1);
					
					//菜单项-监控-链接
					var a_menu_item1 = document.createElement('a');
					a_menu_item1.className = "mui-navigate-right";
					a_menu_item1.href = monitorUrl;
					a_menu_item1.innerHTML = "监控";
					a_menu_item1.setAttribute("open-type","common-embed");
					a_menu_item1.setAttribute("headerTitle","监控审批");
					menu_item1.appendChild(a_menu_item1);
					
					//菜单项-意见
					var menu_item2 = document.createElement('li');
					menu_item2.className = "mui-table-view-cell";
					menu.appendChild(menu_item2);
					
					//菜单项-监控-链接
					var a_menu_item2 = document.createElement('a');
					a_menu_item2.className = "mui-navigate-right";
					a_menu_item2.innerHTML = "意见";
					a_menu_item2.setAttribute("open-type","common-list");
					a_menu_item2.setAttribute("data-type","comment");
					a_menu_item2.setAttribute("headerTitle","审批意见");
					a_menu_item2.setAttribute("piid",record.piid);
					menu_item2.appendChild(a_menu_item2);
					return row;
				}
				return recordStr;
			}
			
			
		</script>
		
	</body>

</html>